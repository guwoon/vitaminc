<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>실시간 다국어 자막</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #original { font-size: 1.5em; margin-bottom: 20px; }
        .language-section {
            margin-bottom: 20px;
        }
        .language-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .translations {
            border: 1px solid #ccc;
            padding: 10px;
            height: 150px;
            overflow-y: auto;
            background-color: #f9f9f9;
        }
        button { padding: 10px 20px; font-size: 1em; }
    </style>
</head>
<body>
    <h1>실시간 다국어 자막</h1>
    <button onclick="startRecognition()">음성 인식 시작</button>
    <div id="original">원본 텍스트: </div>

    <div id="translations-container"></div>

    <script>
        let recognition;
        let languages = {
            'fr': '프랑스어',
            'zh-CN': '중국어(간체)',
            'id': '인도네시아어',
            'mn': '몽골어'
        };

        function startRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('이 브라우저는 음성 인식을 지원하지 않습니다.');
                return;
            }

            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ko-KR'; // 인식 언어: 한국어
            recognition.continuous = true;
            recognition.interimResults = false;

            recognition.onresult = function(event) {
                let transcript = event.results[event.results.length - 1][0].transcript.trim();
                document.getElementById('original').innerText = '원본 텍스트: ' + transcript;
                translateText(transcript);
            };

            recognition.onerror = function(event) {
                console.error('음성 인식 오류:', event.error);
            };

            recognition.start();
        }

        async function translateText(text) {
            for (let [langCode, langName] of Object.entries(languages)) {
                try {
                    let response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=ko|${langCode}`);
                    let data = await response.json();
                    let translatedText = data.responseData.translatedText;

                    appendTranslation(langName, translatedText);
                } catch (error) {
                    console.error('번역 오류:', error);
                }
            }
        }

        function appendTranslation(langName, translatedText) {
            let container = document.getElementById('translations-container');
            let languageSection = document.getElementById(`lang-${langName}`);

            if (!languageSection) {
                // 언어 섹션 생성
                languageSection = document.createElement('div');
                languageSection.className = 'language-section';
                languageSection.id = `lang-${langName}`;

                let title = document.createElement('div');
                title.className = 'language-title';
                title.innerText = langName;

                let translationsDiv = document.createElement('div');
                translationsDiv.className = 'translations';
                translationsDiv.id = `translations-${langName}`;

                languageSection.appendChild(title);
                languageSection.appendChild(translationsDiv);
                container.appendChild(languageSection);
            }

            let translationsDiv = document.getElementById(`translations-${langName}`);

            // 새로운 번역 추가
            let p = document.createElement('p');
            p.innerText = translatedText;
            translationsDiv.appendChild(p);

            // 스크롤을 맨 아래로
            translationsDiv.scrollTop = translationsDiv.scrollHeight;

            // 최대 표시 줄 수 제한 (예: 10줄)
            if (translationsDiv.childElementCount > 10) {
                translationsDiv.removeChild(translationsDiv.firstChild);
            }
        }
    </script>
</body>
</html>
