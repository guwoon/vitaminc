<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>실시간 다국어 자막</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            font-family: Arial, sans-serif;
            display: grid;
            grid-template-rows: auto 1fr;
            grid-template-columns: 1fr;
            grid-template-areas:
                "header"
                "content";
        }
        h1 {
            grid-area: header;
            text-align: center;
            margin: 10px 0;
        }
        #content {
            grid-area: content;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 10px;
            padding: 10px;
            box-sizing: border-box;
        }
        .language-section {
            border: 1px solid #ccc;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-color: #f9f9f9;
        }
        .language-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        .translations {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        .translation-line {
            margin-bottom: 5px;
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            position: fixed;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
    <h1>실시간 다국어 자막</h1>
    <button onclick="startRecognition()">음성 인식 시작</button>

    <div id="content">
        <div class="language-section" id="lang-fr">
            <div class="language-title">프랑스어</div>
            <div class="translations" id="translations-fr"></div>
        </div>
        <div class="language-section" id="lang-zh-CN">
            <div class="language-title">중국어(간체)</div>
            <div class="translations" id="translations-zh-CN"></div>
        </div>
        <div class="language-section" id="lang-id">
            <div class="language-title">인도네시아어</div>
            <div class="translations" id="translations-id"></div>
        </div>
        <div class="language-section" id="lang-mn">
            <div class="language-title">몽골어</div>
            <div class="translations" id="translations-mn"></div>
        </div>
    </div>

    <script>
        let recognition;
        let languages = {
            'fr': '프랑스어',
            'zh-CN': '중국어(간체)',
            'id': '인도네시아어',
            'mn': '몽골어'
        };

        // 각 언어별로 최근 3문장을 저장할 객체 초기화
        let translationHistory = {};

        for (let langCode in languages) {
            translationHistory[langCode] = [];
        }

        function startRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                alert('이 브라우저는 음성 인식을 지원하지 않습니다.');
                return;
            }

            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ko-KR'; // 인식 언어: 한국어
            recognition.continuous = true;
            recognition.interimResults = false;

            recognition.onresult = function(event) {
                let transcript = event.results[event.results.length - 1][0].transcript.trim();
                translateText(transcript);
            };

            recognition.onerror = function(event) {
                console.error('음성 인식 오류:', event.error);
            };

            recognition.start();
        }

        async function translateText(text) {
            for (let langCode of Object.keys(languages)) {
                try {
                    let response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=ko|${langCode}`);
                    let data = await response.json();
                    let translatedText = data.responseData.translatedText;

                    updateTranslation(langCode, translatedText);
                } catch (error) {
                    console.error('번역 오류:', error);
                }
            }
        }

        function updateTranslation(langCode, translatedText) {
            // 번역 기록 업데이트
            let history = translationHistory[langCode];
            history.unshift(translatedText); // 새로운 문장을 앞에 추가
            if (history.length > 3) {
                history.pop(); // 가장 오래된 문장 제거
            }

            // 화면에 번역 내용 업데이트
            let translationsDiv = document.getElementById(`translations-${langCode}`);
            translationsDiv.innerHTML = ''; // 기존 내용 제거

            for (let sentence of history) {
                let p = document.createElement('div');
                p.className = 'translation-line';
                p.innerText = sentence;
                translationsDiv.appendChild(p);
            }
        }
    </script>
</body>
</html>
